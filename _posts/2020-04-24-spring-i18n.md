---
layout: blog
title: Sử dụng I18  Spring
category: blog
tags: [spring]
summery: Sử dụng I18n  Spring
image: /images/blog/spring.png
youtubeId: cfb2J8qx3Ww
---
tham khảo
https://www.baeldung.com/spring-boot-internationalization



. Overview

In this quick tutorial, we're going to take a look at how we can add internationalization to a Spring Boot application.

1. Bước 1 : Thêm dependency spring boot vào file pom.xml

{% highlight java linenos %}
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
    <version>1.5.2.RELEASE</version>
</dependency>
{% endhighlight %}

2. Bước 2 Cấu hình LocaleResolver để ứng dụng có thể biết được  locale (tiếng Mỹ , tiếng Việt hay tiếng Pháp) đang sử dụng là gì ?  

{% highlight java linenos %}
@Bean
public LocaleResolver localeResolver() {
    SessionLocaleResolver slr = new SessionLocaleResolver();
    slr.setDefaultLocale(Locale.US);
    return slr;
}
{% endhighlight %}

LocaleResolver interface có khả năng xát định được ngôn ngữ nào đang sử dụng bởi vì nó có cài đặt chức năng xát định locale
dựa trên session , cookie , Accept-Language , hoặc những giá trị mình thêm trên header của request
Trong ví dụ của chúng ta mình sẽ sử dụng Session để chuyển đổi qua lại các ngôn n

3. Bước 3 cấu hình  LocaleChangeInterceptor

Next, we need to add an interceptor bean that will switch to a new locale based on the value of the lang parameter appended to a request:
Tiếp theo , chúng ta cần thêm một Interceptor có nhiệm vụ chuyển đổi qua lại giữa các  locale mới khi giá trị thay đổi
	
{% highlight java linenos %}
@Bean
public LocaleChangeInterceptor localeChangeInterceptor() {
    LocaleChangeInterceptor lci = new LocaleChangeInterceptor();
    lci.setParamName("lang");
    return lci;
}
{% endhighlight %}

In order to take effect, this bean needs to be added to the application's interceptor registry.

Trong file configure  @Configuration class chúng ta  implement the WebMvcConfigurer interface và  override the addInterceptors() method:
{% endhighlight %}
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(localeChangeInterceptor());
}
{% endhighlight %}

4. Bước 4 Định nghĩa nội dung locale trong file  Message Sources
Mặc định , Spring Boot sẽ tìm kiếm các file messageresource trong thư mục /src/main/resources.
File locale mặc định là message.properties . 
The file for the default locale will have the name messages.properties, and files for each locale will be named messages_XX.properties, where XX is the locale code.

The keys for the values that will be localized have to be the same in every file, with values appropriate to the language they correspond to.

If a key does not exist in a certain requested locale, then the application will fall back to the default locale value.

Let's define a default message file for the English language called messages.properties:
	
greeting=Hello! Welcome to our website!
lang.change=Change the language
lang.eng=English
lang.fr=French

Next, let's create a file called messages_fr.properties for the French language with the same keys:

greeting=Bonjour! Bienvenue sur notre site!
lang.change=Changez la langue
lang.eng=Anglais
lang.fr=Francais

6. Controller and HTML Page

Let's create a controller mapping that will return a simple HTML page called international.html that we want to see in two different languages:

	
@Controller
public class PageController {
 
    @GetMapping("/international")
    public String getInternationalPage() {
        return "international";
    }
}

Since we are using thymeleaf to display the HTML page, the locale-specific values will be accessed using the keys with the syntax #{key}:

	
<h1 th:text="#{greeting}"></h1>

If using JSP files, the syntax is:

	
<h1><spring:message code="greeting" text="default"/></h1>

If we want to access the page with the two different locales we have to add the parameter lang to the URL in the form: /international?lang=fr

If no lang parameter is present on the URL, the application will use the default locale, in our case US locale.

Let's add a drop-down to our HTML page with the two locales whose names are also localized in our properties files:
	
<span th:text="#{lang.change}"></span>:
<select id="locales">
    <option value=""></option>
    <option value="en" th:text="#{lang.eng}"></option>
    <option value="fr" th:text="#{lang.fr}"></option>
</select>

Then we can add a jQuery script that will call the /international URL with the respective lang parameter depending on which drop-down option is selected:

	
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
</script>
<script type="text/javascript">
$(document).ready(function() {
    $("#locales").change(function () {
        var selectedOption = $('#locales').val();
        if (selectedOption != ''){
            window.location.replace('international?lang=' + selectedOption);
        }
    });
});
</script>

7. Running the Application

In order to initialize our application, we have to add the main class annotated with @SpringBootApplication:

	
@SpringBootApplication
public class InternationalizationApp {
     
    public static void main(String[] args) {
        SpringApplication.run(InternationalizationApp.class, args);
    }
}

Depending on the selected locale, we will view the page in either English or French when running the application.

Let's see the English version:


{% include youtubePlayer.html id=page.youtubeId %}